<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PRODTORG | Магазин для своих</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        /* Упрощенные стили для быстрой работы */
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: Arial, sans-serif; background: #f5f5f5; }
        
        .container { max-width: 1200px; margin: 0 auto; padding: 20px; }
        header { background: #2c5aa0; color: white; padding: 20px; }
        .logo { font-size: 24px; font-weight: bold; }
        
        .products-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(250px, 1fr)); gap: 20px; margin: 20px 0; }
        .product-card { background: white; border-radius: 10px; padding: 15px; box-shadow: 0 2px 5px rgba(0,0,0,0.1); }
        .product-card img { width: 100%; height: 200px; object-fit: cover; border-radius: 5px; }
        
        .btn { background: #2c5aa0; color: white; border: none; padding: 10px 15px; border-radius: 5px; cursor: pointer; }
        .btn:hover { background: #1a3a6b; }
        
        .admin-btn { position: fixed; bottom: 20px; right: 20px; background: #ff6b35; color: white; border-radius: 50%; width: 60px; height: 60px; display: flex; align-items: center; justify-content: center; font-size: 24px; cursor: pointer; }
    </style>
</head>
<body>
    <header>
        <div class="container">
            <div class="logo">PRODTORG | Магазин для своих</div>
        </div>
    </header>
    
    <div class="container">
        <h1>Каталог товаров</h1>
        <div id="productsGrid" class="products-grid">
            <!-- Товары будут здесь -->
        </div>
    </div>
    
    <div class="admin-btn" onclick="toggleAdmin()">
        <i class="fas fa-cog"></i>
    </div>
    
    <!-- Админ панель -->
    <div id="adminPanel" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.8); z-index: 1000; padding: 20px; overflow-y: auto;">
        <div style="background: white; border-radius: 10px; padding: 20px; max-width: 800px; margin: 0 auto;">
            <h2>Управление каталогом</h2>
            <button class="btn" onclick="loadFromGoogleSheets()">
                <i class="fas fa-sync"></i> Загрузить из Google Sheets
            </button>
            <button class="btn" onclick="loadDemoData()" style="background: #27ae60;">
                <i class="fas fa-download"></i> Загрузить демо-данные
            </button>
            <hr style="margin: 20px 0;">
            <div id="adminContent"></div>
            <button class="btn" onclick="toggleAdmin()" style="background: #e74c3c; margin-top: 20px;">
                <i class="fas fa-times"></i> Закрыть
            </button>
        </div>
    </div>

    <script>
        let products = [];
        
        function toggleAdmin() {
            const panel = document.getElementById('adminPanel');
            panel.style.display = panel.style.display === 'none' ? 'block' : 'none';
        }
        
        async function loadFromGoogleSheets() {
            try {
                // Используем CORS-прокси для обхода ограничений
                const sheetId = '1udzmDOhQVIUf86IM2GXUFfYm_oOoTlGl6doZdImPr-s';
                const gid = '73523831';
                const proxyUrl = 'https://corsproxy.io/?';
                const sheetsUrl = `https://docs.google.com/spreadsheets/d/${sheetId}/export?format=csv&gid=${gid}`;
                
                const response = await fetch(proxyUrl + encodeURIComponent(sheetsUrl));
                if (!response.ok) throw new Error('Не удалось загрузить данные');
                
                const csvText = await response.text();
                parseCSVData(csvText);
                
                document.getElementById('adminContent').innerHTML = `<p style="color: green;">✅ Загружено ${products.length} товаров</p>`;
            } catch (error) {
                console.error('Ошибка:', error);
                document.getElementById('adminContent').innerHTML = `<p style="color: red;">❌ Ошибка: ${error.message}</p>`;
            }
        }
        
        function parseCSVData(csvText) {
            const lines = csvText.split('\n').filter(line => line.trim() !== '');
            if (lines.length < 2) return;
            
            const delimiter = csvText.includes(';') ? ';' : ',';
            const headers = lines[0].split(delimiter).map(h => h.trim());
            
            products = [];
            for (let i = 1; i < lines.length; i++) {
                const values = lines[i].split(delimiter);
                const product = {};
                
                headers.forEach((header, index) => {
                    if (values[index] !== undefined) {
                        product[header] = values[index].trim();
                    }
                });
                
                if (product['Название товара'] || product['Name']) {
                    products.push({
                        id: i,
                        name: product['Название товара'] || product['Name'] || 'Без названия',
                        category: product['Категория'] || product['Category'] || 'Без категории',
                        price: parseFloat(product['Цена продажи'] || product['Price'] || 0),
                        quantity: parseInt(product['Количество'] || product['Quantity'] || 0),
                        description: product['Описание'] || product['Description'] || '',
                        image: product['URL ссылка на изображение'] || product['Image'] || 'https://via.placeholder.com/300x200/ecf0f1/7f8c8d?text=Нет+изображения'
                    });
                }
            }
            
            renderProducts();
        }
        
        function loadDemoData() {
            products = [
                {
                    id: 1,
                    name: 'FAIRY banane - 5 литров',
                    category: 'Бытовая химия',
                    price: 800,
                    quantity: 10,
                    description: 'Концентрированное средство для мытья посуды',
                    image: 'https://via.placeholder.com/300x200/667eea/ffffff?text=FAIRY'
                },
                {
                    id: 2,
                    name: 'Комплект постельного белья Люкс',
                    category: 'Постельное белье',
                    price: 2500,
                    quantity: 5,
                    description: 'Набор постельного белья из 100% хлопка',
                    image: 'https://via.placeholder.com/300x200/f093fb/ffffff?text=Постельное'
                },
                {
                    id: 3,
                    name: 'Свежая рыба лосось',
                    category: 'Рыба и морепродукты',
                    price: 1200,
                    quantity: 8,
                    description: 'Свежий лосось высшего качества',
                    image: 'https://via.placeholder.com/300x200/4facfe/ffffff?text=Рыба'
                }
            ];
            
            renderProducts();
            document.getElementById('adminContent').innerHTML = `<p style="color: green;">✅ Загружено 3 демо-товара</p>`;
        }
        
        function renderProducts() {
            const grid = document.getElementById('productsGrid');
            if (!grid) return;
            
            grid.innerHTML = products.map(product => `
                <div class="product-card">
                    <img src="${product.image}" alt="${product.name}" 
                         onerror="this.src='https://via.placeholder.com/300x200/ecf0f1/7f8c8d?text=Нет+изображения'">
                    <h3>${product.name}</h3>
                    <p>${product.category}</p>
                    <p><strong>${product.price.toLocaleString()} ₽</strong></p>
                    <p>${product.description.substring(0, 100)}...</p>
                    <button class="btn" onclick="addToCart(${product.id})" style="width: 100%; margin-top: 10px;">
                        <i class="fas fa-cart-plus"></i> В корзину
                    </button>
                </div>
            `).join('');
        }
        
        function addToCart(productId) {
            alert('Товар добавлен в корзину!');
            // Здесь можно добавить логику корзины
        }
        
        // При загрузке страницы показываем демо-данные
        document.addEventListener('DOMContentLoaded', loadDemoData);
    </script>
</body>
</html>
